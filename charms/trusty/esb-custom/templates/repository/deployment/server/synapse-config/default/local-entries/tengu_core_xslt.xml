<?xml version="1.0" encoding="UTF-8"?>
<localEntry xmlns="http://ws.apache.org/ns/synapse" key="tengu_core_xslt">
   <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                   xmlns:emulab="http://www.protogeni.net/resources/rspec/ext/emulab/1"
                   xmlns:client="http://www.protogeni.net/resources/rspec/ext/client/1"
                   xmlns:jFed="http://jfed.iminds.be/rspec/ext/jfed/1"
                   xmlns:jFedBonfire="http://jfed.iminds.be/rspec/ext/jfed-bonfire/1"
                   xmlns:rspec="http://www.geni.net/resources/rspec/3"
                   xmlns:jFed_command="http://jfed.iminds.be/rspec/ext/jfed-command/1"
                   xmlns:tengu="http://tengu.ibcn.ugent.be/1"
                   xmlns:delay="http://www.protogeni.net/resources/rspec/ext/delay/1"
                   xmlns:jfed-ssh-keys="http://jfed.iminds.be/rspec/ext/jfed-ssh-keys/1"
                   xmlns:sharedvlan="http://www.protogeni.net/resources/rspec/ext/shared-vlan/1"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   version="1.0"
                   xsi:schemaLocation="http://www.geni.net/resources/rspec/3 http://www.geni.net/resources/rspec/3/request.xsd">
      <xsl:output method="xml" indent="yes"/>
      <xsl:template match="node()|@*">
         <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
         </xsl:copy>
      </xsl:template>
      <xsl:template match="tengu:hnodes_if">
         <xsl:call-template name="tengu:iterate-hnodes_if"/>
      </xsl:template>
      <xsl:template match="tengu:hnodes">
         <xsl:call-template name="tengu:iterate-hnodes"/>
      </xsl:template>
      <xsl:template match="tengu:snodes_if">
         <xsl:call-template name="tengu:iterate-snodes_if"/>
      </xsl:template>
      <xsl:template match="tengu:snodes">
         <xsl:call-template name="tengu:iterate-snodes"/>
      </xsl:template>
      <xsl:template name="tengu:iterate-hnodes_if">
         <xsl:param name="length" select="@count"/>
         <xsl:param name="i" select="1"/>
         <xsl:if test="$length &gt; 1">
            <rspec:interface_ref>
               <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>:if0</xsl:attribute>
            </rspec:interface_ref>
            <xsl:call-template name="tengu:iterate-hnodes_if">
               <xsl:with-param name="length" select="$length - 1"/>
               <xsl:with-param name="i" select="$i + 1"/>
            </xsl:call-template>
         </xsl:if>
         <xsl:if test="$length = 1">
            <rspec:interface_ref>
               <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>:if0</xsl:attribute>
            </rspec:interface_ref>
            <rspec:interface_ref client_id="hmaster:if0"/>
         </xsl:if>
      </xsl:template>
      <xsl:template name="tengu:iterate-hnodes">
         <xsl:param name="length" select="@count"/>
         <xsl:param name="cmi" select="@component_manager_id"/>
         <xsl:param name="i" select="1"/>
         <xsl:if test="$length &gt; 1">
            <rspec:node exclusive="true">
               <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>
               </xsl:attribute>
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh">
                     <xsl:attribute name="command">cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/hnode<xsl:value-of select="$i"/>.log</xsl:attribute>
                  </rspec:execute>
               </rspec:services>
               <rspec:interface>
                  <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>:if0</xsl:attribute>
               </rspec:interface>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
            <xsl:call-template name="tengu:iterate-hnodes">
               <xsl:with-param name="length" select="$length - 1"/>
               <xsl:with-param name="i" select="$i + 1"/>
            </xsl:call-template>
         </xsl:if>
         <xsl:if test="$length = 1">
            <rspec:node exclusive="true">
               <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>
               </xsl:attribute>
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh">
                     <xsl:attribute name="command">cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/hnode<xsl:value-of select="$i"/>.log</xsl:attribute>
                  </rspec:execute>
               </rspec:services>
               <rspec:interface>
                  <xsl:attribute name="client_id">hnode<xsl:value-of select="$i"/>:if0</xsl:attribute>
               </rspec:interface>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
            <rspec:node client_id="hmaster" exclusive="true">
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh"
                                 command="cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/hmaster.log"/>
               </rspec:services>
               <rspec:interface client_id="hmaster:if0"/>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
         </xsl:if>
      </xsl:template>
      <xsl:template name="tengu:iterate-snodes_if">
         <xsl:param name="length" select="@count"/>
         <xsl:param name="i" select="1"/>
         <xsl:if test="$length &gt; 1">
            <rspec:interface_ref>
               <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>:if0</xsl:attribute>
            </rspec:interface_ref>
            <xsl:call-template name="tengu:iterate-snodes_if">
               <xsl:with-param name="length" select="$length - 1"/>
               <xsl:with-param name="i" select="$i + 1"/>
            </xsl:call-template>
         </xsl:if>
         <xsl:if test="$length = 1">
            <rspec:interface_ref>
               <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>:if0</xsl:attribute>
            </rspec:interface_ref>
            <rspec:interface_ref client_id="nimbus:if0"/>
         </xsl:if>
      </xsl:template>
      <xsl:template name="tengu:iterate-snodes">
         <xsl:param name="length" select="@count"/>
         <xsl:param name="cmi" select="@component_manager_id"/>
         <xsl:param name="i" select="1"/>
         <xsl:if test="$length &gt; 1">
            <rspec:node exclusive="true">
               <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>
               </xsl:attribute>
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh">
                     <xsl:attribute name="command">cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/snode<xsl:value-of select="$i"/>.log</xsl:attribute>
                  </rspec:execute>
               </rspec:services>
               <rspec:interface>
                  <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>:if0</xsl:attribute>
               </rspec:interface>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
            <xsl:call-template name="tengu:iterate-snodes">
               <xsl:with-param name="length" select="$length - 1"/>
               <xsl:with-param name="i" select="$i + 1"/>
            </xsl:call-template>
         </xsl:if>
         <xsl:if test="$length = 1">
            <rspec:node exclusive="true">
               <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>
               </xsl:attribute>
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh">
                     <xsl:attribute name="command">cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/snode<xsl:value-of select="$i"/>.log</xsl:attribute>
                  </rspec:execute>
               </rspec:services>
               <rspec:interface>
                  <xsl:attribute name="client_id">snode<xsl:value-of select="$i"/>:if0</xsl:attribute>
               </rspec:interface>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
            <rspec:node client_id="nimbus" exclusive="true">
               <xsl:attribute name="component_manager_id">
                  <xsl:value-of select="$cmi"/>
               </xsl:attribute>
               <rspec:sliver_type name="raw-pc"/>
               <rspec:services>
                  <rspec:execute shell="sh"
                                 command="cd /opt; sudo wget -6 -q http://tengu.test.iminds.be/scripts/v1.0/proxy.sh; sudo chmod +x proxy.sh; sudo /opt/proxy.sh | sudo tee -a /opt/nimbus.log"/>
               </rspec:services>
               <rspec:interface client_id="nimbus:if0"/>
               <jFed:nodeDescription>simple-node</jFed:nodeDescription>
            </rspec:node>
         </xsl:if>
      </xsl:template>
   </xsl:stylesheet>
   <description/>
</localEntry>
