<?xml version="1.0" encoding="UTF-8"?>
<api xmlns="http://ws.apache.org/ns/synapse"
     name="scripts"
     context="/scripts">
   <resource methods="GET" uri-template="/{tool}/{script}">
      <inSequence>
         <log level="custom">
            <property name="seq" value="in"/>
            <property name="tool" expression="get-property('uri.var.tool')"/>
            <property name="script" expression="get-property('uri.var.script')"/>
         </log>
         <loopback/>
      </inSequence>
      <outSequence>
         <property name="script_body"
                   expression="get-property(concat('scripts_', get-property('uri.var.tool'), '_', get-property('uri.var.script')))"/>
         <log level="custom">
            <property name="seq" value="out"/>
            <property name="tool" expression="get-property('uri.var.tool')"/>
            <property name="script" expression="get-property('uri.var.script')"/>
            <property name="body" expression="get-property('script_body')"/>
         </log>
         <property name="NO_ENTITY_BODY" scope="axis2" action="remove"/>
         <property name="messageType"
                   value="text/plain"
                   scope="axis2"
                   type="STRING"/>
         <script language="js">var sb = mc.getProperty("script_body");            mc.setPayloadXML(&lt;text xmlns="http://ws.apache.org/commons/ns/payload"&gt;{sb}&lt;/text&gt;);</script>
         <log level="full"/>
         <send/>
      </outSequence>
   </resource>
</api>
