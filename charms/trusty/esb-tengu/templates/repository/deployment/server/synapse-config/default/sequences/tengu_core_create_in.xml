<?xml version="1.0" encoding="UTF-8"?>
<sequence xmlns="http://ws.apache.org/ns/synapse" name="tengu_core_create_in">
   <property xmlns:ns="http://org.apache.synapse/xsd"
             name="ref"
             expression="get-property('MessageID')"
             scope="default"
             type="STRING"/>
   <log level="custom">
      <property xmlns:ns="http://org.apache.synapse/xsd"
                name="snodes"
                expression="get-property('query.param.snodes')"/>
      <property xmlns:ns="http://org.apache.synapse/xsd"
                name="testbed"
                expression="get-property('query.param.testbed')"/>
      <property xmlns:ns="http://org.apache.synapse/xsd"
                name="hnodes"
                expression="get-property('query.param.hnodes')"/>
      <property xmlns:ns="http://org.apache.synapse/xsd"
                name="ref"
                expression="get-property('ref')"/>
   </log>
   <payloadFactory media-type="xml">
      <format key="tengu_core_rspec"/>
      <args>
         <arg xmlns:ns="http://org.apache.synapse/xsd"
              evaluator="xml"
              expression="get-property('query.param.testbed')"/>
         <arg xmlns:ns="http://org.apache.synapse/xsd"
              evaluator="xml"
              expression="get-property('query.param.hnodes')"/>
         <arg xmlns:ns="http://org.apache.synapse/xsd"
              evaluator="xml"
              expression="get-property('query.param.snodes')"/>
      </args>
   </payloadFactory>
   <xslt key="tengu_core_xslt"/>
   <dbreport>
      <connection>
         <pool>
            <dsName>jdbc/tengu_DB</dsName>
         </pool>
      </connection>
      <statement>
         <sql>
                        INSERT INTO projects (ref, tool, nodes, hnodes, snodes, testbed) VALUES (?, 'core', 0, ?, ?, ?);</sql>
         <parameter xmlns:ns="http://org.apache.synapse/xsd"
                    expression="get-property('MessageID')"
                    type="VARCHAR"/>
         <parameter xmlns:ns="http://org.apache.synapse/xsd"
                    expression="get-property('query.param.hnodes')"
                    type="INTEGER"/>
         <parameter xmlns:ns="http://org.apache.synapse/xsd"
                    expression="get-property('query.param.snodes')"
                    type="INTEGER"/>
         <parameter xmlns:ns="http://org.apache.synapse/xsd"
                    expression="get-property('query.param.testbed')"
                    type="VARCHAR"/>
      </statement>
   </dbreport>
   <dblookup>
      <connection>
         <pool>
            <dsName>jdbc/tengu_DB</dsName>
         </pool>
      </connection>
      <statement>
         <sql>
                              SELECT CONCAT(tool,ID) AS id FROM projects WHERE ref=?;</sql>
         <parameter xmlns:ns="http://org.apache.synapse/xsd"
                    expression="get-property('ref')"
                    type="VARCHAR"/>
         <result name="slice" column="id"/>
      </statement>
   </dblookup>
   <sequence key="tengu_send_jfed"/>
</sequence>
