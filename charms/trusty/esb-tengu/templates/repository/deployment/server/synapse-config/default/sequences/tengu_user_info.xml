<?xml version="1.0" encoding="UTF-8"?>
<sequence xmlns="http://ws.apache.org/ns/synapse" name="tengu_user_info">
   <property xmlns:ns="http://org.apache.synapse/xsd"
             name="ref"
             expression="get-property('MessageID')"/>
   <property xmlns:ns="http://org.apache.synapse/xsd"
             name="s4cert"
             expression="get-property('query.param.s4cert')"/>
   <property xmlns:ns="http://org.apache.synapse/xsd"
             name="uri.var.ref"
             expression="substring-after(get-property('ref'),'urn:uuid:')"
             scope="default"
             type="STRING"/>
   <log level="custom">
      <property xmlns:ns="http://org.apache.synapse/xsd"
                name="ref"
                expression="get-property('uri.var.ref')"/>
   </log>
   <property xmlns:ns="http://org.apache.synapse/xsd"
             name="uri.var.slice"
             expression="get-property('uri.var.ref')"
             scope="default"
             type="STRING"/>
   <property name="messageType" value="text/plain" scope="axis2"/>
   <header name="Accept" scope="transport" value="text/xml"/>
   <property name="HTTP_METHOD" value="POST" scope="axis2" type="STRING"/>
   <payloadFactory media-type="xml">
      <format>
         <nsc:text xmlns:nsc="http://ws.apache.org/commons/ns/payload">$1</nsc:text>
      </format>
      <args>
         <arg xmlns:ns="http://org.apache.synapse/xsd"
              evaluator="xml"
              expression="get-property('s4cert')"/>
      </args>
   </payloadFactory>
   <call>
      <endpoint key="jfed_create_cert_2"/>
   </call>
   <log level="custom">
      <property xmlns:ns="http://org.apache.synapse/xsd" name="body" expression="$body"/>
   </log>
   <script language="js">mc.getEnvelope().getBody().getFirstElement().detach();</script>
   <log level="custom">
      <property xmlns:ns="http://org.apache.synapse/xsd" name="body" expression="$body"/>
   </log>
   <send>
      <endpoint key="jfed_user_info"/>
   </send>
</sequence>
